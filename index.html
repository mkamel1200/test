<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patient Stipend Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{background:#f4f7fa}
    .card{background:#fff;border-radius:.75rem;box-shadow:0 4px 10px rgba(0,0,0,.05)}
    .step{display:none}.active{display:block}.pill{cursor:pointer}
    .tile{@apply cursor-pointer p-3 border rounded-lg text-sm flex items-center gap-2}
    .tile[data-picked='true']{@apply bg-blue-50 border-blue-400}
  </style>
</head>
<body class="font-sans text-gray-800">
<div class="max-w-4xl mx-auto p-6">

  <!-- =========  HEADER  ========= -->
  <h1 class="text-3xl font-bold text-center text-blue-800 mb-8">
    ğŸ’Š Patient Stipend Calculator
  </h1>

  <!-- =========  BASIC CALCULATOR  ========= -->
  <div id="calcCard" class="card p-6 mb-8">
    <div class="grid grid-cols-2 gap-4">
      <!-- exact chartâ€‘aligned dropdowns -->
      <label>Invasiveness
        <select id="I" class="w-full p-2 border rounded">
          <option value="0">Purely observational</option>
          <option value="1">Venepuncture / topical</option>
          <option value="2">Biopsy / lumbar puncture</option>
          <option value="3">Surgical / firstâ€‘inâ€‘human device</option>
        </select>
      </label>
      <label>Perâ€‘visit Duration
        <select id="D" class="w-full p-2 border rounded">
          <option value="0">&lt;1â€¯h</option>
          <option value="1">1â€‘4â€¯h</option>
          <option value="2">4â€‘8â€¯h</option>
          <option value="3">â‰¥24â€¯h / overnight</option>
        </select>
      </label>
      <label>Study Duration
        <select id="S" class="w-full p-2 border rounded">
          <option value="0">0â€‘3â€¯months</option>
          <option value="1">3â€‘12â€¯months</option>
          <option value="2">12â€‘24â€¯months</option>
          <option value="3">&gt;24â€¯months</option>
        </select>
      </label>
      <label>Visitâ€¯Frequency
        <select id="F" class="w-full p-2 border rounded">
          <option value="0">â‰¤1 / month</option>
          <option value="1">2â€‘3 / month</option>
          <option value="2">4â€‘7 / month</option>
          <option value="3">â‰¥8 / month</option>
        </select>
      </label>
      <label>Perceivedâ€¯Risk
        <select id="R" class="w-full p-2 border rounded">
          <option value="0">Minimal</option>
          <option value="1">Low</option>
          <option value="2">Moderate</option>
          <option value="3">High / unknown</option>
        </select>
      </label>
      <label>Logisticalâ€¯Complexity
        <select id="L" class="w-full p-2 border rounded">
          <option value="0">None</option>
          <option value="1">Fastingâ€¯/â€¯eDiary</option>
          <option value="2">Fastingâ€¯+â€¯eDiaryâ€¯+â€¯childcare</option>
          <option value="3">Home prepâ€¯+â€¯device mgmt</option>
        </select>
      </label>
      <label>Radiationâ€¯Exposure
        <select id="X" class="w-full p-2 border rounded">
          <option value="0">None</option>
          <option value="1">Single Xâ€‘ray</option>
          <option value="2">Multiple CT / NM scans</option>
          <option value="3">PETâ€‘CT (high)</option>
        </select>
      </label>
      <label>Therapeuticâ€¯Area
        <select id="TBM" class="w-full p-2 border rounded">
          <option value="0.75">Oncology / Lifeâ€‘threatening</option>
          <option value="1.0" selected>Chronic disease</option>
          <option value="1.25">Healthy volunteer / Vaccine</option>
        </select>
      </label>
    </div>
    <div class="text-center mt-6">
      <button id="calcBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">
        Calculate
      </button>
      <p id="result" class="mt-4 text-2xl font-semibold text-green-700">Stipend: â€”</p>
    </div>
  </div>

  <!-- =========  TOGGLE BUTTON  ========= -->
  <div class="text-center mb-10">
    <button onclick="toggleDesigner(true)"
            class="bg-purple-600 hover:bg-purple-700 text-white px-5 py-2 rounded">
      ğŸ® Tryâ€¯Trialâ€¯Designerâ€¯Mode
    </button>
  </div>

  <!-- =========  DESIGNER MODE  ========= -->
  <div id="designer" class="hidden card p-6">
    <!-- step nav -->
    <div class="flex justify-between mb-6 font-medium">
      <div id="s1tab" class="pill text-purple-700">1âƒ£ StudyÂ Type</div>
      <div id="s2tab" class="pill text-gray-500">2âƒ£ Attributes</div>
      <div id="s3tab" class="pill text-gray-500">3âƒ£ Summary</div>
    </div>

    <!-- STEPÂ 1 -->
    <div id="s1" class="step active">
      <h2 class="text-xl font-bold mb-4">Pick a Therapeutic Area</h2>
      <div class="grid grid-cols-3 gap-4">
        <div class="tile bg-yellow-100" onclick="pickTA(1.0,'Chronic Disease')">ğŸ’Š Chronic</div>
        <div class="tile bg-green-100"  onclick="pickTA(1.25,'Vaccine / Healthy')">ğŸ’‰ VaccineÂ / Healthy</div>
        <div class="tile bg-red-100"    onclick="pickTA(1.0,'Infectious Disease')">ğŸ¦  InfectiousÂ Disease</div>
      </div>
    </div>

    <!-- STEPÂ 2 -->
    <div id="s2" class="step">
      <h2 class="text-xl font-bold mb-4">Select Burden Attributes<br>
        <span class="text-sm text-gray-500">(click all that apply)</span></h2>
      <div id="attrHolder" class="space-y-6"></div>
      <div class="text-right mt-6">
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
                onclick="goStep(3)">Next â†’</button>
      </div>
    </div>

    <!-- STEPÂ 3 -->
    <div id="s3" class="step text-center">
      <h2 class="text-xl font-bold mb-4">Summary</h2>
      <canvas id="radar" width="380" height="300" class="mx-auto"></canvas>
      <p id="gStip" class="text-2xl font-semibold text-green-700 mt-4"></p>
      <button class="mt-6 bg-gray-500 text-white px-4 py-2 rounded"
              onclick="toggleDesigner(false)">â† Back to Calculator</button>
    </div>
  </div>
</div>

<script>
/* ----------   BASIC CALC   ---------- */
const els = ['I','D','S','F','R','L','X','TBM'].map(id=>document.getElementById(id));
const resEl=document.getElementById('result');
function base(I,D,S,F,R,X,L){return 30+20*I+35*D+5*S+5*F+10*R+10*X+10*L}
function updateCalc(){
  const vals=els.slice(0,7).map(el=>+el.value),
        tbm =+document.getElementById('TBM').value,
        stipend=Math.round(base(...vals)*tbm);
  resEl.textContent=`Stipend: $${stipend}`;
}
document.getElementById('calcBtn').onclick=updateCalc;
els.forEach(el=>el.addEventListener('change',updateCalc));

/* ----------   DESIGNER  ---------- */
function $(id){return document.getElementById(id);}
function toggleDesigner(on){
  $('calcCard').classList.toggle('hidden',on);
  $('designer').classList.toggle('hidden',!on);
  goStep(1);
}

/* step handling */
function goStep(n){
  [1,2,3].forEach(i=>{
    $('s'+i).classList.toggle('active',i===n);
    $('s'+i+'tab').classList.toggle('text-purple-700',i===n);
    $('s'+i+'tab').classList.toggle('text-gray-500',i!==n);
  });
  if(n===2) buildAttrUI();
  if(n===3) showSummary();
}
let taTBM=1, picked={};
function pickTA(tbm){taTBM=tbm; goStep(2);}

/* attribute library */
const attrSets={
  I:{label:'Invasiveness',items:[
    {txt:'Venepuncture / topical',score:1},
    {txt:'Coreâ€‘needle biopsy',    score:2},
    {txt:'Surgical implant',      score:3}]},
  D:{label:'Perâ€‘visitÂ Duration',items:[
    {txt:'Observation 1â€‘4â€¯h',     score:1},
    {txt:'Long infusion 4â€‘8â€¯h',   score:2},
    {txt:'Overnight stay â‰¥24â€¯h',  score:3}]},
  S:{label:'StudyÂ Duration',items:[
    {txt:'3â€‘12â€¯months',score:1},{txt:'12â€‘24â€¯months',score:2},
    {txt:'>24â€¯months',score:3}]},
  F:{label:'VisitÂ Frequency',items:[
    {txt:'Biâ€‘weekly',score:1},{txt:'Weekly',score:2},{txt:'Daily onâ€‘site',score:3}]},
  R:{label:'PerceivedÂ Risk',items:[
    {txt:'Topical OTC',score:1},{txt:'Knownâ€‘class biologic',score:2},
    {txt:'Firstâ€‘inâ€‘class biologic',score:3}]},
  L:{label:'Logistics',items:[
    {txt:'Fasting',score:1},{txt:'eDiary',score:1},
    {txt:'Childâ€‘care',score:2},{txt:'Home prepÂ +Â device',score:3}]},
  X:{label:'Radiation',items:[
    {txt:'Single Xâ€‘ray',score:1},{txt:'Multiple CTs',score:2},{txt:'PETâ€‘CT',score:3}]}
};

function buildAttrUI(){
  picked={}; $('attrHolder').innerHTML='';
  for(const k in attrSets){
    const g=attrSets[k];
    const wrap=document.createElement('div');
    wrap.innerHTML=`<p class='font-semibold mb-2'>${g.label}</p>`;
    const grid=document.createElement('div');grid.className='grid grid-cols-3 gap-2';
    g.items.forEach(o=>{
      const d=document.createElement('div');
      d.className='tile border-gray-300'; d.textContent=o.txt;
      d.dataset.domain=k; d.dataset.score=o.score;
      d.onclick=()=>toggleTile(d);
      grid.appendChild(d);
    });
    wrap.appendChild(grid); $('attrHolder').appendChild(wrap);
  }
}
function toggleTile(div){
  const dom=div.dataset.domain, sc=+div.dataset.score;
  const on=div.dataset.picked==='true';
  div.dataset.picked=(!on).toString();
  div.classList.toggle('bg-blue-50',!on);
  div.classList.toggle('border-blue-400',!on);
  /* recompute domain max */
  const tiles=[...document.querySelectorAll(`.tile[data-domain='${dom}']`)];
  const max=tiles.filter(t=>t.dataset.picked==='true')
                 .reduce((m,t)=>Math.max(m,+t.dataset.score),0);
  picked[dom]=max;
}

/* summary + radar */
let chart;
function showSummary(){
  const s={I:0,D:0,S:0,F:0,R:0,L:0,X:0,...picked};
  const stipend=Math.round(base(s.I,s.D,s.S,s.F,s.R,s.X,s.L)*taTBM);
  $('gStip').textContent=`Stipend: $${stipend}`;
  const data={labels:['I','D','S','F','R','L','X'],
    datasets:[{data:[s.I,s.D,s.S,s.F,s.R,s.L,s.X],
      backgroundColor:'rgba(0,123,153,0.3)',borderColor:'#007C91',borderWidth:2}]};
  if(chart) chart.destroy();
  chart=new Chart($('radar'),{type:'radar',data,
    options:{scale:{ticks:{beginAtZero:true,max:3,stepSize:1}}}});
}
</script>
</body>
</html>
