<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patient Stipend Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {background:#f4f7fa}
    .card {background:#fff;border-radius:.75rem;box-shadow:0 4px 10px rgba(0,0,0,.05)}
    .step {display:none}
    .active {display:block}
    .pill  {cursor:pointer}
    .tile  {@apply cursor-pointer p-3 rounded-lg border text-sm flex items-center gap-2}
    .tile[data-picked="true"]{@apply bg-blue-50 border-blue-400}
  </style>
</head>
<body class="font-sans text-gray-800">
<div class="max-w-4xl mx-auto p-6">
  <h1 class="text-3xl font-bold text-center text-blue-800 mb-8">
    üíä Patient Stipend Calculator
  </h1>

  <!-- ======== DESIGNER CARD ======== -->
  <div class="card p-6">

    <!-- STEP NAV -->
    <div class="flex justify-between mb-6 font-medium">
      <div id="s1tab" class="pill text-purple-700">1‚É£ Study‚ÄØType</div>
      <div id="s2tab" class="pill text-gray-500">2‚É£ Attributes</div>
      <div id="s3tab" class="pill text-gray-500">3‚É£ Summary</div>
    </div>

    <!--  STEP 1  -->
    <div id="s1" class="step active">
      <h2 class="text-xl font-bold mb-4">Pick a Therapeutic Area</h2>
      <div class="grid grid-cols-3 gap-4">
        <div class="tile bg-yellow-100" onclick="pickTA(1.0,'Chronic Disease')">üíä Chronic</div>
        <div class="tile bg-green-100"  onclick="pickTA(1.25,'Vaccine / Healthy')">üíâ Vaccine / Healthy</div>
        <div class="tile bg-red-100"    onclick="pickTA(1.0,'Infectious Disease')">ü¶† Infectious Disease</div>
      </div>
    </div>

    <!--  STEP 2  -->
    <div id="s2" class="step">
      <h2 class="text-xl font-bold mb-4">Select Burden Attributes<br><span class="text-sm text-gray-500">(click all that apply)</span></h2>
      <div id="attrHolder" class="space-y-6"></div>
      <div class="text-right mt-6">
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
                onclick="goStep(3)">Next ‚Üí</button>
      </div>
    </div>

    <!--  STEP 3  -->
    <div id="s3" class="step text-center">
      <h2 class="text-xl font-bold mb-4">Summary</h2>
      <canvas id="radar" width="380" height="300" class="mx-auto"></canvas>
      <p id="gStip" class="text-2xl font-semibold text-green-700 mt-4"></p>
      <button class="mt-6 bg-gray-500 text-white px-4 py-2 rounded"
              onclick="goStep(1)">‚Üê Start Over</button>
    </div>

  </div>
</div>

<script>
/* ---------- attribute library ---------- */
const attributeSets = {
  I: { label:'Invasiveness',
       items:[
         {txt:'Venepuncture / topical',score:1},
         {txt:'Core‚Äëneedle biopsy',    score:2},
         {txt:'Surgical implant / explant',score:3}
       ]},
  D: { label:'Per‚Äëvisit Duration',
       items:[
         {txt:'Observation 1‚Äë4‚ÄØh',    score:1},
         {txt:'Long infusion 4‚Äë8‚ÄØh',  score:2},
         {txt:'Overnight stay ‚â•24‚ÄØh', score:3}
       ]},
  S: { label:'Study Duration',
       items:[
         {txt:'3‚Äì12‚ÄØmonths', score:1},
         {txt:'12‚Äì24‚ÄØmonths',score:2},
         {txt:'>24‚ÄØmonths',  score:3}
       ]},
  F: { label:'Visit Frequency',
       items:[
         {txt:'Bi‚Äëweekly visits',score:1},
         {txt:'Weekly visits',  score:2},
         {txt:'Daily on‚Äësite',  score:3}
       ]},
  R: { label:'Perceived Risk',
       items:[
         {txt:'Topical OTC',           score:1},
         {txt:'Known‚Äëclass biologic',  score:2},
         {txt:'First‚Äëin‚Äëclass biologic',score:3}
       ]},
  L: { label:'Logistics',
       items:[
         {txt:'Fasting',                  score:1},
         {txt:'eDiary',                   score:1},
         {txt:'Child‚Äëcare support',       score:2},
         {txt:'Home prep‚ÄØ+‚ÄØdevice mgmt',  score:3}
       ]},
  X: { label:'Radiation',
       items:[
         {txt:'Single X‚Äëray',     score:1},
         {txt:'Multiple CT scans',score:2},
         {txt:'PET‚ÄëCT',           score:3}
       ]}
};

let currentTA  = {tbm:1, name:''};
let picked     = {};       // {I:score, D:score ...}
let radarChart;

/* ---------- DOM helpers ---------- */
function $(id){return document.getElementById(id);}
function goStep(k){
  [1,2,3].forEach(n=>{
    $('s'+n).classList.toggle('active',n===k);
    $('s'+n+'tab').classList.toggle('text-purple-700',n===k);
    $('s'+n+'tab').classList.toggle('text-gray-500',n!==k);
  });
  if(k===2) buildAttrUI();
  if(k===3) showSummary();
}
function pickTA(tbm,name){currentTA={tbm,name}; goStep(2);}

/* ---------- build attribute checklist ---------- */
function buildAttrUI(){
  $('attrHolder').innerHTML='';
  picked={}; // reset
  for(const key of Object.keys(attributeSets)){
    const group = attributeSets[key];
    const wrap = document.createElement('div');
    wrap.innerHTML=`<p class="font-semibold mb-2">${group.label}</p>`;
    const grid=document.createElement('div'); grid.className='grid grid-cols-3 gap-2';
    group.items.forEach((it,i)=>{
      const div=document.createElement('div');
      div.className='tile border-gray-300';
      div.dataset.domain=key;
      div.dataset.score=it.score;
      div.onclick=()=>toggleTile(div);
      div.textContent=it.txt;
      grid.appendChild(div);
    });
    wrap.appendChild(grid);
    $('attrHolder').appendChild(wrap);
  }
}
function toggleTile(div){
  const domain=div.dataset.domain;
  const score =+div.dataset.score;
  const pickedNow=div.dataset.picked==='true';
  if(pickedNow){div.dataset.picked='false';div.classList.remove('bg-blue-50','border-blue-400');}
  else{div.dataset.picked='true';div.classList.add('bg-blue-50','border-blue-400');}
  // recompute domain max
  const tiles=[...document.querySelectorAll(`.tile[data-domain='${domain}']`)];
  const max=tiles.filter(t=>t.dataset.picked==='true').reduce((m,t)=>Math.max(m,+t.dataset.score),0);
  picked[domain]=max;
}

/* ---------- summary step ---------- */
function calcBase(obj){
  const {I=0,D=0,S=0,F=0,R=0,X=0,L=0}=obj;
  return 30+20*I+35*D+5*S+5*F+10*R+10*X+10*L;
}
function showSummary(){
  // ensure every domain present
  const scores={I:0,D:0,S:0,F:0,R:0,X:0,L:0,...picked};
  const stipend = Math.round(calcBase(scores)*currentTA.tbm);
  $('gStip').textContent = `Stipend: $${stipend}`;

  const data = {
    labels:['I','D','S','F','R','L','X'],
    datasets:[{label:'Burden',data:[scores.I,scores.D,scores.S,scores.F,scores.R,scores.L,scores.X],
      backgroundColor:'rgba(0,123,153,0.3)',borderColor:'#007C91',borderWidth:2}]};
  if(radarChart) radarChart.destroy();
  radarChart=new Chart($('radar'),{type:'radar',data,
    options:{scale:{ticks:{beginAtZero:true,max:3,stepSize:1}}}});
}

/* kick off */
goStep(1);
</script>
</body>
</html>

